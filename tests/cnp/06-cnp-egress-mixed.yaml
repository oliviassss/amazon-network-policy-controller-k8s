apiVersion: networking.k8s.aws/v1alpha1
kind: ClusterNetworkPolicy
metadata:
  name: cnp-egress-mixed-example
spec:
  tier: Admin
  priority: 100
  subject:
    namespaces: {}
  egress:
  - name: allow-internal-and-apis
    action: Accept
    to:
    - networks:
      - "10.0.0.0/8"
      - "172.16.0.0/12"
    - domainNames:
      - "api.github.com"
      - "registry-1.docker.io"
    ports:
    - portNumber:
        protocol: TCP
        port: 443
    - portNumber:
        protocol: TCP
        port: 80
  - name: allow-to-staging-namespace
    action: Accept
    to:
    - namespaces:
        matchLabels:
          environment: staging
    ports:
    - portNumber:
        protocol: TCP
        port: 80
  - name: pass-to-backend-pods
    action: Pass
    to:
    - pods:
        namespaceSelector:
          matchLabels:
            environment: production
        podSelector:
          matchLabels:
            component: backend
    ports:
    - portNumber:
        protocol: TCP
        port: 3000
  - name: deny-external
    action: Deny
    to:
    - networks:
      - "0.0.0.0/0"
