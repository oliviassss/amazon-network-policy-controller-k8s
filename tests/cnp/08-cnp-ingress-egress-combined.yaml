apiVersion: networking.k8s.aws/v1alpha1
kind: ClusterNetworkPolicy
metadata:
  name: cnp-ingress-egress-combined-example
spec:
  tier: Admin
  priority: 150
  subject:
    namespaces:
      matchLabels:
        environment: production
  ingress:
  - name: allow-frontend-access
    action: Accept
    from:
    - namespaces:
        matchLabels:
          tier: application
    ports:
    - portNumber:
        protocol: TCP
        port: 8080
  - name: deny-ingress-from-default-ns
    action: Deny
    from:
    - namespaces:
        matchLabels:
          kubernetes.io/metadata.name: staging
  egress:
  - name: allow-internal-and-apis
    action: Accept
    to:
    - networks:
      - "10.0.0.0/8"
      - "172.16.0.0/12"
    - domainNames:
      - "api.github.com"
      - "registry-1.docker.io"
    ports:
    - portNumber:
        protocol: TCP
        port: 443
  - name: deny-external-egress
    action: Deny
    to:
    - networks:
      - "0.0.0.0/0"
